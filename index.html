<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Wardle</title>
  <link rel="canonical" href="https://syntaxistaxsyn.github.io/Wardle/" />
  <link rel="manifest" href="/Wardle/manifest.webmanifest">
  <link rel="stylesheet" href="css/styles.css">
  <style>
  :root{
    --bg:#0b0b0b;
    --cell:#111;
    --cell-border:#222;
    --text:#fff;
    --green:#6aaa64;
    --yellow:#c9b458;
    --red:#b13b3b;
    --key-bg:#818384;
    --key-fg:#fff;
    --accent:#3a3a3a;
  }
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,#050505,#0b0b0b);
    color:var(--text);
    display:flex;
    flex-direction:column;
    min-height:100vh;
    box-sizing:border-box;
  }
  h1{margin:10px 0; font-size:20px; font-weight:600;}
  .controls{
    display:flex;
    gap:8px;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
    justify-content:center;
  }
  .btn{
    padding:6px 6px;
    background:var(--accent);
    color:var(--text);
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  #fileLabel{
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  input[type=file]{ display:none; }
  #status{ margin-left:8px; font-size:14px; color:#ddd; }

  /* Center the whole game area */
  #game {
    display: flex;
    flex-direction: column;
    align-items: center;    /* horizontal center */
    justify-content: center; /* vertical center */
    flex-grow: 1;           /* take up available space */
  }

  /* Center and tighten the board grid */
  .board{
    display:grid;
    grid-template-columns: repeat(5, minmax(44px, 50px));
    gap:4px;               /* tighter gap */
    justify-content: center;
    margin:12px 0 18px;
  }
  .row{
    display:contents;
  }
  .cell{
    width:64px;
    height:64px;
    background:var(--cell);
    border:2px solid var(--cell-border);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    font-weight:700;
    color:var(--text);
    text-transform:uppercase;
    user-select:none;
    border-radius:8px;
    box-sizing:border-box;
  }
  .cell.filled{ border-color: #444; }
  .cell.invalid { background: var(--red); color:#fff; animation: shake 300ms; }
  @keyframes shake{
    0%{ transform:translateX(0) }
    25%{ transform:translateX(-6px) }
    50%{ transform:translateX(6px) }
    75%{ transform:translateX(-4px) }
    100%{ transform:translateX(0) }
  }

  .keyboard{
    margin-top:10px;
    display:flex;
    flex-direction:column;
    gap:8px;
    align-items:center;
  }
  .keyrow{
    display:flex;
    gap:6px;
  }
  .key{
    padding:10px 12px;
    min-width:42px;
    border-radius:8px;
    background:var(--key-bg);
    color:var(--key-fg);
    font-weight:700;
    text-transform:uppercase;
    cursor:pointer;
    border:none;
    user-select:none;
  }
  .key.wide{ min-width:72px; }
  .key:active{ transform:translateY(1px); }
  .key.state-correct{ background:var(--green); color:#fff; }
  .key.state-present{ background:var(--yellow); color:#000; }
  .key.state-absent{ background:#3a3a3a; color:#fff; opacity:0.9; }

  .message{
    margin-top:12px;
    min-height:20px;
    font-size:15px;
    color:#ddd;
    text-align:center;
  }

  /* Responsive */
  @media (max-width:520px){
    .cell{ width:48px; height:48px; font-size:22px; }
    .board{ gap:3px; }
    .key{ padding:8px 10px; min-width:36px; }
    .key.wide{ min-width:58px; }
  }
</style>

</head>
<body>
  <h1>5-letter Guess Game</h1>

  <div class="controls">
    <!--
    <label id="fileLabel" class="btn">
      Upload dictionary
      <input id="dictFile" type="file" accept=".txt,.csv" />
    </label>-->
    <button id="resetBtn" class="btn" disabled>Reset</button>
    <div id="status">No dictionary loaded</div>
  </div>

  <div id="game" aria-live="polite">
    <div id="board" class="board" aria-hidden="false"></div>
    <div class="keyboard" id="keyboard"></div>
    <div class="message" id="message"></div>
  </div>

  <script>
      if (navigator.serviceWorker) {
        navigator.serviceWorker.register (
          '/Wardle/sw.js',
          {scope: '/Wardle/'}
        )
      }
  </script>
  <script src="js/app.js"></script>
  <script>
    (() => {
  const ROWS = 6;
  const COLS = 5;
  const boardEl = document.getElementById('board');
  const keyboardEl = document.getElementById('keyboard');
  const fileInput = document.getElementById('dictFile');
  const statusEl = document.getElementById('status');
  const resetBtn = document.getElementById('resetBtn');
  const messageEl = document.getElementById('message');

  let dictionary = new Set();
  let wordList = [];
  let solution = '';
  let curRow = 0;
  let curCol = 0;
  let grid = [];
  let gameOver = true;

  const KEY_ROWS = [
    "QWERTYUIOP".split(""),
    "ASDFGHJKL".split(""),
    ["Enter","Z","X","C","V","B","N","M","Del"]
  ];

  // Automatically fetch dictionary on load
  fetch('/Wardle/five_letter_words.txt')
    .then(response => {
      if (!response.ok) throw new Error('Failed to load dictionary');
      return response.text();
    })
    .then(text => {
      parseDictionaryText(text);
    })
    .catch(err => {
      console.error(err);
      statusEl.textContent = 'Failed to load dictionary file.';
      statusEl.style.color = '#f88';
    });

  function buildGrid() {
    boardEl.innerHTML = '';
    grid = [];
    for (let r=0;r<ROWS;r++) {
      const rowArr = [];
      for (let c=0;c<COLS;c++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.row = r;
        cell.dataset.col = c;
        boardEl.appendChild(cell);
        rowArr.push(cell);
      }
      grid.push(rowArr);
    }
  }

  function buildKeyboard() {
    keyboardEl.innerHTML = '';
    for (const row of KEY_ROWS) {
      const rowDiv = document.createElement('div');
      rowDiv.className = 'keyrow';
      for (const key of row) {
        const k = document.createElement('button');
        k.className = 'key';
        if (key === 'Enter' || key === 'Del') k.classList.add('wide');
        k.textContent = key.toUpperCase();
        k.dataset.key = key;
        k.addEventListener('click', () => handleKey(key));
        rowDiv.appendChild(k);
      }
      keyboardEl.appendChild(rowDiv);
    }
  }

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => parseDictionaryText(ev.target.result);
    reader.readAsText(file);
  });

  function parseDictionaryText(text) {
    const lines = text.split(/\r?\n/);
    const set = new Set();
    const arr = [];
    for (let L of lines) {
      if (!L) continue;
      L = L.trim();
      const token = L.split(/[,\s]+/)[0];
      if (!token) continue;
      const up = token.toUpperCase();
      if (/^[A-Z]{5}$/.test(up)) {
        if (!set.has(up)) {
          set.add(up);
          arr.push(up);
        }
      }
    }
    dictionary = set;
    wordList = arr;
    if (dictionary.size === 0) {
      statusEl.textContent = 'No valid 5-letter words found.';
      statusEl.style.color = '#f88';
      resetBtn.disabled = true;
      gameOver = true;
      return;
    }
    statusEl.textContent = `${dictionary.size} five-letter words loaded`;
    statusEl.style.color = '#dfe';
    resetBtn.disabled = false;
    startGame();
  }

  function startGame() {
    buildGrid();
    buildKeyboard();
    curRow = 0;
    curCol = 0;
    gameOver = false;
    messageEl.textContent = '';
    clearKeyboardStates();
    solution = wordList[Math.floor(Math.random() * wordList.length)];
    console.log('Solution (debug):', solution);
  }

  resetBtn.addEventListener('click', () => {
    if (dictionary.size === 0) {
      messageEl.textContent = 'Load a dictionary first.';
      return;
    }
    startGame();
  });

  window.addEventListener('keydown', (e) => {
    if (gameOver) return;
    if (e.key === 'Backspace') {
      e.preventDefault();
      handleKey('Del');
    } else if (e.key === 'Enter') {
      e.preventDefault();
      handleKey('Enter');
    } else if (/^[a-zA-Z]$/.test(e.key)) {
      handleKey(e.key.toUpperCase());
    }
  });

  function handleKey(key) {
    if (gameOver) return;
    if (key === 'Del') {
      if (curCol > 0) {
        curCol--;
        grid[curRow][curCol].textContent = '';
        grid[curRow][curCol].classList.remove('filled','invalid');
      }
      return;
    }
    if (key === 'Enter') {
      if (curCol < COLS) {
        messageEl.textContent = 'Not enough letters';
        return;
      }
      const guess = getRowWord(curRow);
      if (!dictionary.has(guess)) {
        flashInvalidRow(curRow);
        messageEl.textContent = 'Not in dictionary';
        return;
      }
      evaluateGuess(guess);
      return;
    }
    if (/^[A-Z]$/.test(key)) {
      if (curCol >= COLS) return;
      grid[curRow][curCol].textContent = key;
      grid[curRow][curCol].classList.add('filled');
      curCol++;
      messageEl.textContent = '';
    }
  }

  function getRowWord(row) {
    return grid[row].map(cell => cell.textContent || '').join('').toUpperCase();
  }

  function flashInvalidRow(row) {
    for (let c=0;c<COLS;c++) grid[row][c].classList.add('invalid');
    setTimeout(() => {
      for (let c=0;c<COLS;c++) grid[row][c].classList.remove('invalid');
    }, 700);
  }

  function evaluateGuess(guess) {
    const sol = solution;
    const result = new Array(COLS).fill('absent');
    const solLetters = sol.split('');
    const guessLetters = guess.split('');

    for (let i=0;i<COLS;i++){
      if (guessLetters[i] === solLetters[i]) {
        result[i] = 'correct';
        solLetters[i] = null;
        guessLetters[i] = null;
      }
    }
    const solCounts = {};
    for (let i=0;i<COLS;i++){
      if (solLetters[i]) solCounts[solLetters[i]] = (solCounts[solLetters[i]]||0)+1;
    }
    for (let i=0;i<COLS;i++){
      if (guessLetters[i]) {
        if (solCounts[guessLetters[i]]) {
          result[i] = 'present';
          solCounts[guessLetters[i]]--;
        }
      }
    }

    for (let i=0;i<COLS;i++){
      const cell = grid[curRow][i];
      if (result[i] === 'correct') {
        cell.style.background = 'var(--green)';
        cell.style.color = '#fff';
      } else if (result[i] === 'present') {
        cell.style.background = 'var(--yellow)';
        cell.style.color = '#000';
      } else {
        cell.style.background = 'var(--cell)';
        cell.style.color = '#fff';
      }
    }

    setTimeout(() => updateKeyboardStates(guess, result), 200);

    if (result.every(r => r === 'correct')) {
      messageEl.textContent = 'You win! 🎉';
      gameOver = true;
      return;
    }
    curRow++;
    curCol = 0;
    if (curRow >= ROWS) {
      gameOver = true;
      messageEl.textContent = `Out of guesses — solution was "${solution}"`;
    }
  }

  function updateKeyboardStates(guess, result) {
    for (let i=0;i<COLS;i++){
      const letter = guess[i];
      const state = result[i];
      const keyBtn = findKeyButton(letter);
      if (!keyBtn) continue;
      if (state === 'correct') {
        keyBtn.classList.remove('state-present','state-absent');
        keyBtn.classList.add('state-correct');
      } else if (state === 'present') {
        if (!keyBtn.classList.contains('state-correct')) {
          keyBtn.classList.remove('state-absent');
          keyBtn.classList.add('state-present');
        }
      } else {
        if (!keyBtn.classList.contains('state-correct') && !keyBtn.classList.contains('state-present')) {
          keyBtn.classList.add('state-absent');
        }
      }
    }
  }

  function findKeyButton(key) {
    return Array.from(keyboardEl.querySelectorAll('.key'))
      .find(b => b.dataset.key.toUpperCase() === key.toUpperCase());
  }

  function clearKeyboardStates() {
    keyboardEl.querySelectorAll('.key').forEach(b => {
      b.classList.remove('state-correct','state-present','state-absent');
    });
  }

  buildGrid();
  buildKeyboard();
  messageEl.textContent = 'Upload a dictionary file to start.';
})();

  </script>
</body>
</html>
